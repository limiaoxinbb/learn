# UniST

## 优势

UniST通过以下方式取得成功：

（i）利用来自不同场景的多样化时空数据，

（ii）有效的预训练以捕获复杂的时空动态，

（iii）知识引导的提示以增强泛化能力。这些设计共同释放了为各种场景构建通用模型的潜力。

在本文中，我们的目标是建立通用城市时空预测的基础模型，具体来说，开发一种通用模型，在不同的时空场景中提供卓越的性能和强大的泛化能力。

## 预训练和提示学习

### 阶段一

第一阶段：大规模时空预训练。 与仅限于单个数据集的现有方法不同，我们的方法利用来自各个领域和城市的广泛时空数据进行预训练。

### 阶段二

第二阶段：时空知识引导的提示学习。 我们引入了一种用于上下文学习的提示网络，其中提示的生成是由完善的时空域知识（例如空间层次结构和时间周期性）自适应引导的。

## 准备工作

### 时空分区

$H\times W$块

### 时空数据

$T\times C\times H\times W$四维张量。

### 时空预测

用lh历史数据预测未来k时刻的数据。

### 少样本和零样本数据

少样本微调，零样本直接预测。



## 基础模型

我们的基本模型是一个基于transformer的编码器-解码器架构。通过时空分块，可以统一的顺序格式处理各种时空数据。

### 时空分块

![image-20241105172506385](C:\Users\27528\AppData\Roaming\Typora\typora-user-images\image-20241105172506385.png)

### 位置编码

由于原始 Transformer 架构不考虑序列的顺序，因此我们遵循结合位置编码的常见做法 [9]。 为了增强泛化能力，我们选择正弦和余弦函数而不是可学习参数来进行位置编码。 该编码分别应用于空间和时间维度。

### 编码器-解码器结构

基本模型采用受 Masked Autoencoder (MAE) [18] 启发的编码器解码器框架。 它以一定的掩蔽比处理输入补丁，其中编码器获取未掩蔽的补丁，解码器使用编码器的输出和掩蔽的补丁重建图像。 我们的重点是捕获全面的时空依赖性，包括高层和低层关系，目标是准确预测特定时间和空间坐标的值。 与使用轻量级解码器进行预训练的 MAE 不同，我们的模型采用全尺寸解码器，在预训练和微调中都发挥着至关重要的作用。

![image-20241105173418433](C:\Users\27528\AppData\Roaming\Typora\typora-user-images\image-20241105173418433.png)

## 时空自监督预训练

- 随机掩蔽
- 管掩蔽
- 块掩蔽
- 时间掩蔽

通过采用这些多样化的掩蔽策略，模型可以从综合角度系统地增强其建模能力，同时解决时空、空间和时间关系。

## 时空知识引导提示



![image-20241105174840172](C:\Users\27528\AppData\Roaming\Typora\typora-user-images\image-20241105174840172.png)

## 时空领域知识

![image-20241106090455189](C:\Users\27528\AppData\Roaming\Typora\typora-user-images\image-20241106090455189.png)

需要强调的是，𝐸𝑠𝑐、𝐸𝑠ℎ、𝐸𝑡𝑐、𝐸𝑡𝑝的学习不受我们修行的限制。 从业者可以灵活地采用更复杂的设计来捕获更丰富的时空属性。 例如，基于傅立叶的方法 [38, 60] 可用于捕获周期性模式。



![image-20241105181140674](C:\Users\27528\AppData\Roaming\Typora\typora-user-images\image-20241105181140674.png)

左侧展示了输入数据的多种时空分块方式，如随机、块状和管状分块。

中间部分展示了 Stage 1 的预训练过程，使用 Transformer 进行时空特征的学习。

右侧的 Stage 2 展示了知识引导的提示学习，通过提示网络以及空间和时间的记忆池来优化时空数据的理解。

![image-20241106091942331](C:\Users\27528\AppData\Roaming\Typora\typora-user-images\image-20241106091942331.png)

在图中，$P_{tc}$、$P_{tp}$、$P_{sc}$、和 $P_{sh}$ 是**知识引导的提示**（knowledge-guided prompts），它们分别对应不同类型的时空特征。具体来说：

- **$P_{tc}$**：代表与时间上下文相关的提示（Temporal Context Prompt）。它捕捉的是时间维度中的短期或上下文信息。
- **$P_{tp}$**：代表周期时间相关的提示（Temporal Period Prompt）。它用于捕捉时间维度中的周期性或长期模式。
- **$P_{sc}$**：代表空间上下文相关的提示（Spatial Context Prompt）。它关注空间维度中的短距离或细节信息。
- **$P_{sh}$**：代表空间层次相关的提示（Spatial Hierarchy Prompt）。它捕捉空间维度中更大尺度或分层的信息。

这些提示（prompts）相当于从时空记忆池中提取出的嵌入信息，用于引导模型生成针对当前任务的特定提示，使模型更好地理解复杂的时空关系。

利用**记忆网络**的思想，构建了**空间记忆池**和**时间记忆池**。在提示学习过程中，这些记忆池被优化，用于存储关于时空领域知识的关键信息。

![image-20241105174144925](C:\Users\27528\AppData\Roaming\Typora\typora-user-images\image-20241105174144925.png)

在图3中展示了提示生成过程的结构，其中：

1. **空间记忆池** 和 **时间记忆池** 分别存储空间和时间信息。这些信息以键-值的方式组织，其中键（例如 $K_S$ 和 $K_T$）和值（例如 $M_S$ 和$M_T$）都是可学习的参数。
2. **时空特征嵌入** 被用作查询，用于从记忆池中提取相关的嵌入信息，从而生成提示。

最终，系统将这些嵌入整合起来，生成用于模型的提示。通过这种方式，时空提示生成器能够根据不同任务动态生成合适的提示，从而更高效地利用时空信息。

## 时空提示学习器

![image-20241106092744473](C:\Users\27528\AppData\Roaming\Typora\typora-user-images\image-20241106092744473.png)

![image-20241106092728827](C:\Users\27528\AppData\Roaming\Typora\typora-user-images\image-20241106092728827.png)

